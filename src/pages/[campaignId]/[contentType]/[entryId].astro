---
import { getCollection, render, getEntry } from 'astro:content';

import { CAMPAIGNS, CONTENT_TYPES } from '../../../constants.ts';
import Layout from '../../../layouts/Layout.astro';

export async function getStaticPaths() {
  const paths = [];
  for (const contentType of CONTENT_TYPES) {
    const entries = await getCollection(contentType);
    for (const entry of entries) {
      const [campaignId, , entryId] = entry.id.split('/');
      paths.push({
        params: { campaignId, contentType, entryId },
      });
    }
  }
  return paths;
}

const { campaignId, contentType, entryId } = Astro.params;
const entry = await getEntry(contentType, `${campaignId}/${contentType}/${entryId}`);
const { Content } = await render(entry);
const campaign = CAMPAIGNS.find((c) => c.id === campaignId)!;
---

<Layout
  title={`${campaign.label} | ${entry.data.name}`}
  campaignSlug={campaignId}
  campaignName={campaign.label}
>
  <Content />
</Layout>
